---
sidebar_position: 4
title: Chapter 3 - Humanoid Modeling with URDF
---

# Chapter 3: Humanoid Modeling with URDF

## Learning Objectives

After completing this chapter, you will be able to:
- Understand the purpose and structure of URDF (Unified Robot Description Format)
- Define robot links, joints, and frames in URDF
- Create simple URDF models for humanoid robots
- Connect URDF models to ROS 2 control systems
- Understand how URDF integrates with ROS 2 for robot control and simulation

## Introduction

URDF (Unified Robot Description Format) is the standard XML-based format used in ROS to describe robot models. It defines the physical and visual properties of a robot, including its structure, joints, and how different parts are connected. Understanding URDF is essential for working with robot models in ROS 2, especially when developing for humanoid robots.

## URDF Purpose and Structure

URDF serves as the digital blueprint of a robot, describing its physical structure and properties. It allows ROS to understand:
- The robot's physical structure (links and joints)
- How different parts move relative to each other
- Visual and collision properties
- Inertial properties for physics simulation

### URDF Structure Overview

A URDF file is an XML document that contains:
- **Robot element**: The root element that contains the entire robot description
- **Links**: Rigid parts of the robot structure
- **Joints**: Connections between links that allow movement
- **Materials**: Visual properties for rendering
- **Gazebo elements**: Simulation-specific properties (though we're not using simulation in this module)

### Basic URDF Example

```xml
<?xml version="1.0"?>
<robot name="simple_robot">
  <!-- Base link -->
  <link name="base_link">
    <visual>
      <geometry>
        <cylinder length="0.6" radius="0.2"/>
      </geometry>
    </visual>
  </link>

  <!-- Child link -->
  <link name="child_link">
    <visual>
      <geometry>
        <box size="0.1 0.1 0.1"/>
      </geometry>
    </visual>
  </link>

  <!-- Joint connecting the links -->
  <joint name="base_to_child" type="continuous">
    <parent link="base_link"/>
    <child link="child_link"/>
    <origin xyz="0 0 0.3" rpy="0 0 0"/>
  </joint>
</robot>
```

## Links: The Building Blocks of Robot Structure

Links represent the rigid parts of a robot. They are the fundamental building blocks that define the physical structure of the robot.

### Link Properties

Each link can define:
- **Visual properties**: How the link looks in visualization
- **Collision properties**: How the link interacts in collision detection
- **Inertial properties**: Mass, center of mass, and inertia tensor for physics simulation

### Visual Properties

Visual properties define how a link appears in visualizations:

```xml
<link name="link_name">
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <box size="1 1 1"/>
      <!-- or <cylinder radius="0.1" length="0.5"/> -->
      <!-- or <sphere radius="0.1"/> -->
      <!-- or <mesh filename="package://path/to/mesh.stl"/> -->
    </geometry>
    <material name="color">
      <color rgba="0.8 0.2 0.2 1.0"/>
    </material>
  </visual>
</link>
```

### Collision Properties

Collision properties define how a link interacts with other objects:

```xml
<link name="link_name">
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <box size="1 1 1"/>
    </geometry>
  </collision>
</link>
```

### Inertial Properties

Inertial properties define the physical characteristics for simulation:

```xml
<link name="link_name">
  <inertial>
    <mass value="1.0"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
  </inertial>
</link>
```

## Joints: Connecting Robot Parts

Joints define how links are connected and how they can move relative to each other. They are crucial for creating articulated robots.

### Joint Types

ROS supports several joint types:

- **Revolute**: Rotational joint with limited range
- **Continuous**: Rotational joint without limits
- **Prismatic**: Linear sliding joint with limited range
- **Fixed**: No movement between links
- **Floating**: 6 DOF movement (rarely used)
- **Planar**: Movement on a plane (rarely used)

### Joint Definition

```xml
<joint name="joint_name" type="revolute">
  <parent link="parent_link_name"/>
  <child link="child_link_name"/>
  <origin xyz="0 0 0.1" rpy="0 0 0"/>
  <axis xyz="0 0 1"/>
  <limit lower="-1.57" upper="1.57" effort="10.0" velocity="1.0"/>
</joint>
```

### Joint Properties

- **Parent/Child**: Defines the connection between two links
- **Origin**: Position and orientation of the joint relative to the parent
- **Axis**: Direction of movement (for revolute/prismatic joints)
- **Limits**: Range of motion, effort, and velocity constraints

## Frames: Coordinate Systems in URDF

Frames in URDF represent coordinate systems attached to links. They are essential for understanding robot kinematics and for transforming between different parts of the robot.

![URDF Structure Diagram](/img/urdf-structure.txt "Diagram showing the structure of URDF (Unified Robot Description Format): links as rigid parts of the robot structure, joints as connections between links that allow movement, and frames as coordinate systems attached to links. Illustrates how URDF models connect to ROS 2 control systems.")

### TF (Transform) Tree

URDF defines a tree structure of transforms that ROS uses through the tf2 system:

- Each link has its own coordinate frame
- Joints define transforms between frames
- The tf2 system allows transformation between any two frames
- This enables complex kinematic calculations

### Frame Naming Convention

Frames are typically named using the link name, and ROS tools like RViz can visualize these frames and their relationships.

## Creating a Simple Humanoid URDF Model

Let's create a basic humanoid model with a torso, head, arms, and legs:

```xml
<?xml version="1.0"?>
<robot name="simple_humanoid">
  <!-- Materials -->
  <material name="blue">
    <color rgba="0.0 0.0 1.0 1.0"/>
  </material>
  <material name="white">
    <color rgba="1.0 1.0 1.0 1.0"/>
  </material>

  <!-- Torso -->
  <link name="torso">
    <visual>
      <geometry>
        <box size="0.3 0.2 0.5"/>
      </geometry>
      <material name="white"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.3 0.2 0.5"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="5.0"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
    </inertial>
  </link>

  <!-- Head -->
  <link name="head">
    <visual>
      <geometry>
        <sphere radius="0.1"/>
      </geometry>
      <material name="white"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.1"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>

  <!-- Neck joint -->
  <joint name="neck_joint" type="revolute">
    <parent link="torso"/>
    <child link="head"/>
    <origin xyz="0 0 0.35"/>
    <axis xyz="0 1 0"/>
    <limit lower="-0.5" upper="0.5" effort="10.0" velocity="1.0"/>
  </joint>

  <!-- Left arm -->
  <link name="left_upper_arm">
    <visual>
      <geometry>
        <cylinder length="0.3" radius="0.05"/>
      </geometry>
      <material name="blue"/>
    </visual>
    <inertial>
      <mass value="0.5"/>
      <origin xyz="0 0 -0.15"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>

  <joint name="left_shoulder_joint" type="revolute">
    <parent link="torso"/>
    <child link="left_upper_arm"/>
    <origin xyz="0.2 0.1 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="10.0" velocity="1.0"/>
  </joint>
</robot>
```

## Connecting URDF to ROS 2 Control Systems

URDF models integrate with ROS 2 through several mechanisms:

### Robot State Publisher

The `robot_state_publisher` node reads the URDF and publishes the state of all joints to the tf2 system:

- Subscribes to joint state messages on `/joint_states`
- Calculates forward kinematics
- Publishes transforms between all frames
- Allows other nodes to query the robot's configuration

### Joint State Publisher

The `joint_state_publisher` node can publish joint states for visualization:

- Either publishes fixed joint states
- Or provides a GUI to manually set joint positions
- Or interfaces with real hardware to publish actual joint positions

### Controllers

ROS 2 control systems use URDF information to:
- Understand the robot's kinematic structure
- Apply control algorithms to move joints
- Ensure joint limits are respected
- Perform safety checks

### Example Launch File

A typical launch file for a robot with URDF would include:

```python
from launch import LaunchDescription
from launch.substitutions import Command
from launch_ros.actions import Node
from ament_index_python.packages import get_package_share_directory
import os


def generate_launch_description():
    # Get URDF via xacro
    robot_description_content = Command([
        'xacro ',
        os.path.join(
            get_package_share_directory('your_robot_description'),
            'urdf',
            'your_robot.urdf.xacro'
        )
    ])

    robot_description = {'robot_description': robot_description_content}

    node_robot_state_publisher = Node(
        package='robot_state_publisher',
        executable='robot_state_publisher',
        output='screen',
        parameters=[robot_description]
    )

    return LaunchDescription([
        node_robot_state_publisher
    ])
```

## Execution Instructions for URDF Examples

To work with URDF models in ROS 2:

1. Make sure your ROS 2 environment is sourced:
   ```bash
   source /opt/ros/humble/setup.bash
   ```

2. Navigate to the examples directory:
   ```bash
   cd docs/module-1-ros2/examples/
   ```

3. To check if your URDF is valid:
   ```bash
   check_urdf basic-urdf.urdf
   ```

4. To visualize your URDF in RViz:
   ```bash
   # Terminal 1: Publish the robot description
   ros2 run robot_state_publisher robot_state_publisher --ros-args -p robot_description:=$(cat basic-urdf.urdf)

   # Terminal 2: Launch RViz
   rviz2
   ```

5. In RViz, add a RobotModel display and set the topic to visualize your robot.

## URDF Best Practices

### Organization

- Use Xacro for complex robots to avoid repetition
- Separate URDF into multiple files for different parts
- Use consistent naming conventions

### Validation

- Always validate URDF syntax before use
- Check for proper tree structure (no loops)
- Verify joint limits and physical properties

### Performance

- Keep URDF simple for real-time applications
- Use appropriate level of detail for your application
- Consider using mesh models for complex shapes

## Summary

In this chapter, we've covered:
- The purpose and structure of URDF for describing robots
- How to define links, joints, and frames in URDF
- Creating a simple humanoid robot model
- How URDF connects to ROS 2 control systems
- Best practices for URDF development

URDF is fundamental to working with robot models in ROS 2, providing the necessary information for visualization, control, and understanding of robot kinematics.

## Next Steps

Return to [Chapter 1: ROS 2 Fundamentals](./chapter-1-fundamentals) to review core concepts, or revisit [Chapter 2: ROS 2 Communication Patterns](./chapter-2-communication) to strengthen your understanding of communication mechanisms.

## Self-Assessment Questions

1. What does URDF stand for and what is its purpose?
2. Name the three main elements that make up a URDF model.
3. What is the difference between visual and collision properties in URDF?
4. List the different joint types available in URDF.
5. How does the robot_state_publisher node use URDF information?